# 🚀 机器学习教学平台 - Nginx部署指南

## 📦 已准备的文件

### 1. 构建产物
- **位置**: `out/` 目录
- **内容**: 所有静态HTML、JS、CSS文件
- **大小**: 约 100+ KB (gzip后更小)

### 2. Nginx配置
- **文件**: `nginx.conf`
- **用途**: Nginx服务器配置模板

---

## 🔨 部署步骤

### 方案一：Linux服务器部署

#### 1. 上传文件到服务器

```bash
# 在本地，打包out目录
cd "D:\cursor-demo\非代码\机器学习网站"
tar -czf mllearning-dist.tar.gz out/

# 上传到服务器（替换your-server为实际地址）
scp mllearning-dist.tar.gz user@your-server:/tmp/
```

或者使用FTP/SFTP工具（如FileZilla）上传整个`out`目录。

#### 2. 在服务器上解压

```bash
# SSH登录服务器
ssh user@your-server

# 创建部署目录
sudo mkdir -p /usr/share/nginx/html/mllearning

# 解压文件
cd /tmp
tar -xzf mllearning-dist.tar.gz
sudo cp -r out/* /usr/share/nginx/html/mllearning/

# 设置权限
sudo chown -R nginx:nginx /usr/share/nginx/html/mllearning
sudo chmod -R 755 /usr/share/nginx/html/mllearning
```

#### 3. 配置Nginx

```bash
# 复制nginx配置
sudo nano /etc/nginx/conf.d/mllearning.conf

# 粘贴nginx.conf的内容，并修改：
# - server_name: 改成你的域名或IP
# - root: 确认路径正确

# 测试配置
sudo nginx -t

# 重载nginx
sudo nginx -s reload
# 或
sudo systemctl reload nginx
```

#### 4. 防火墙设置（如果需要）

```bash
# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --reload

# Ubuntu/Debian
sudo ufw allow 'Nginx Full'
```

#### 5. 访问网站

```
http://your-domain.com
http://your-domain.com/visualizations
```

---

### 方案二：Windows服务器部署

#### 1. 安装Nginx for Windows

下载：http://nginx.org/en/download.html

```powershell
# 解压到某个目录，例如：
C:\nginx\
```

#### 2. 复制文件

```powershell
# 复制out目录内容
xcopy /E /I "D:\cursor-demo\非代码\机器学习网站\out" "C:\nginx\html\mllearning"
```

#### 3. 配置Nginx

编辑 `C:\nginx\conf\nginx.conf`，在http块内添加：

```nginx
server {
    listen 80;
    server_name localhost;

    root C:/nginx/html/mllearning;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /visualizations {
        try_files $uri $uri.html /visualizations.html;
    }

    location /_next/static/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 4. 启动Nginx

```powershell
cd C:\nginx
start nginx

# 重载配置
nginx -s reload

# 停止
nginx -s stop
```

#### 5. 访问

```
http://localhost
http://localhost/visualizations
```

---

### 方案三：使用Docker部署

#### 1. 创建Dockerfile

在项目根目录创建 `Dockerfile.nginx`:

```dockerfile
FROM nginx:alpine

# 复制构建产物
COPY out/ /usr/share/nginx/html/

# 复制nginx配置
COPY nginx-docker.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### 2. 创建nginx-docker.conf

```nginx
server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /visualizations {
        try_files $uri $uri.html /visualizations.html;
    }

    location /_next/static/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml text/javascript;
}
```

#### 3. 构建和运行

```bash
# 构建镜像
docker build -f Dockerfile.nginx -t mllearning:latest .

# 运行容器
docker run -d -p 80:80 --name mllearning mllearning:latest

# 查看日志
docker logs mllearning
```

---

## 🌐 域名和HTTPS配置

### 使用Let's Encrypt（免费SSL证书）

```bash
# 安装certbot
sudo apt install certbot python3-certbot-nginx  # Ubuntu/Debian
sudo yum install certbot python3-certbot-nginx  # CentOS

# 获取证书并自动配置nginx
sudo certbot --nginx -d your-domain.com

# 自动续期
sudo certbot renew --dry-run
```

配置后nginx会自动更新为：

```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    
    # ... 其他配置
}

server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}
```

---

## 📊 验证部署

### 1. 检查文件

```bash
# 确认文件存在
ls -la /usr/share/nginx/html/mllearning/
ls -la /usr/share/nginx/html/mllearning/_next/

# 应该看到：
# index.html
# visualizations.html
# 404.html
# _next/ 目录
```

### 2. 检查Nginx状态

```bash
# Linux
sudo systemctl status nginx
sudo nginx -t

# 查看错误日志
sudo tail -f /var/log/nginx/error.log
```

### 3. 测试页面

```bash
# 测试主页
curl http://your-domain.com

# 测试可视化页面
curl http://your-domain.com/visualizations

# 测试404
curl http://your-domain.com/nonexistent
```

### 4. 浏览器测试

打开浏览器访问：
- ✅ http://your-domain.com - 主页
- ✅ http://your-domain.com/visualizations - 可视化页面
- ✅ 测试所有7个算法
- ✅ 检查Console无错误

---

## 🔧 常见问题

### 问题1: 404错误

**原因**: Nginx找不到文件

**解决**:
```bash
# 检查文件路径
sudo ls -la /usr/share/nginx/html/mllearning/

# 检查nginx配置中的root路径
sudo nginx -T | grep root
```

### 问题2: 403 Forbidden

**原因**: 权限问题

**解决**:
```bash
# 设置正确的所有者
sudo chown -R nginx:nginx /usr/share/nginx/html/mllearning/

# 设置正确的权限
sudo chmod -R 755 /usr/share/nginx/html/mllearning/
```

### 问题3: CSS/JS加载失败

**原因**: 路径问题

**解决**:
- 检查浏览器Console
- 确保 `_next/static/` 目录存在
- 检查nginx access.log看实际请求路径

### 问题4: 页面刷新后404

**原因**: Nginx没有配置SPA路由

**解决**: 确保nginx.conf中有：
```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

---

## 🎯 性能优化

### 1. 启用Gzip压缩

已在nginx.conf中配置，确保开启：
```nginx
gzip on;
gzip_types text/plain text/css application/json application/javascript;
```

### 2. 设置缓存

静态资源已设置1年缓存：
```nginx
location /_next/static/ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

### 3. 使用CDN（可选）

将 `_next/static/` 目录上传到CDN，修改HTML中的路径。

---

## 📁 文件清单

```
项目根目录/
├── out/                      # 构建产物（上传这个）
│   ├── _next/                # Next.js资源
│   │   └── static/           # 静态文件
│   ├── index.html            # 主页
│   ├── visualizations.html   # 可视化页面
│   └── 404.html              # 404页面
├── nginx.conf                # Nginx配置模板
└── 部署指南.md               # 本文件
```

---

## 🚀 快速部署命令

```bash
# 1. 在本地打包
cd "D:\cursor-demo\非代码\机器学习网站"
tar -czf mllearning-dist.tar.gz out/

# 2. 上传到服务器
scp mllearning-dist.tar.gz user@your-server:/tmp/

# 3. 在服务器上执行
ssh user@your-server
cd /tmp
tar -xzf mllearning-dist.tar.gz
sudo mkdir -p /usr/share/nginx/html/mllearning
sudo cp -r out/* /usr/share/nginx/html/mllearning/
sudo chown -R nginx:nginx /usr/share/nginx/html/mllearning

# 4. 配置nginx（复制nginx.conf内容）
sudo nano /etc/nginx/conf.d/mllearning.conf

# 5. 重载nginx
sudo nginx -t && sudo nginx -s reload
```

---

## ✅ 部署检查清单

- [ ] 文件已上传到服务器
- [ ] Nginx配置正确
- [ ] 文件权限正确（755）
- [ ] Nginx已重载
- [ ] 防火墙已开放80端口
- [ ] 主页可以访问
- [ ] 可视化页面可以访问
- [ ] 所有7个算法正常工作
- [ ] Console无错误
- [ ] 性能正常（加载快）

---

## 📞 技术支持

如有问题：
1. 检查Nginx错误日志：`sudo tail -f /var/log/nginx/error.log`
2. 检查浏览器Console
3. 验证文件完整性
4. 测试nginx配置：`sudo nginx -t`

---

**部署完成后，你的机器学习可视化平台就可以对外提供服务了！** 🎉

访问地址：
- 主页：http://your-domain.com
- 可视化：http://your-domain.com/visualizations

